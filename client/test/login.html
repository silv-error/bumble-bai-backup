<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="./static/register.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
    </head>

    <body>

        <div class="container-fluid g-0">
            <!--header-->
            <div class="row d-flex g-0 justify-content-center">
                <div class="col-2">
                    <img src="{{ url_for('static', filename='img/bumble.png')}}" class="logo">
                </div>
            </div>
            <div id="message" class="alert alert-info" style="display: none; text-align: center;"></div>

            <!--Access Page-->
            <div class="col-12 access-page">
              <div class="row g-0">
                <div class="col-8 d-flex justify-content-center">
                  <a href="javascript:history.back()"><svg xmlns="http://www.w3.org/2000/svg" id="back-arrow" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"></path></svg></a>
                </div>
              </div>
                <div class="row d-flex g-0 justify-content-center">
                    <div class="col-4">
                        <h1 id="Register">Register Account</h1>
                    </div>
                </div>
                <div class="row d-flex g-0 justify-content-center">
                    <div class="col-4">
                        <p id="Set">Set your account</p>
                    </div> 
                </div>

                <!--Registration Form-->
                <div class="row d-flex g-0 justify-content-center">
                    <div class="col-4">
                        <form onsubmit="fetchData(event)">
                            <div class="row g-0">
                                <div class="col-7 input">
                                    <label for="fname">First name:</label>
                                        <div class="col-4">
                                            <input type="text" id="firstName" name="fname" class="reg_form">
                                        </div>
                                </div>
                                <div class="col-3 input">
                                    <label for="lname">Last name:</label>
                                        <div class="col-4">
                                            <input type="text" id="lastName" name="lname" class="reg_form">
                                        </div>
                                </div>
                            </div>
                            <div class="row g-0">
                                <div class="col-8 input">
                                    <label for="Username">Username:</label>
                                        <div class="col-4">
                                            <input type="text" id="username" name="Username" class="reg_form">
                                        </div>
                                </div>
                            </div>
                            <div class="row g-0">
                                <div class="col-8 input">
                                    <label for="Email">Email:</label>
                                        <div class="col-4">
                                            <input type="email" id="email" name="Email" class="reg_form">
                                        </div>
                                </div>
                            </div>
                            <div class="row g-0">
                                <div class="col-8 input">
                                    <label for="Pword">Password:</label>
                                        <div class="col-4">
                                            <input type="password" id="password1" name="pword" class="reg_form">
                                        </div>
                                </div>
                            </div>
                            <div class="row g-0">
                                <div class="col-8 input">
                                    <label for="Pword">Confirm Password:</label>
                                        <div class="col-4">
                                            <input type="password" id="password2" name="pword" class="reg_form">
                                        </div>
                                </div>
                            </div>
                            <div class="row d-flex g-0 justify-content-center">
                                <div class="col-4 input d-flex justify-content-center">
                                    <button type="submit" id="Confirm">confirm</button>
                                </div>
                            </div>
                        </form>

                        <div class="row d-flex g-0 justify-content-center">
                            <div class="col-12">
                                <div class="row d-flex g-0 justify-content-center">
                                    <div class="col-6 divider">or</div>
                                </div>
                                <div class="row d-flex g-0 justify-content-center">
                                    <div class="col-8">
                                        <p id="number_msg">Sign up with your number instead</p>
                                    </div>
                                </div>
                                <div class="row g-0">
                                    <form action="#" method="">
                                        <div class="col-12 phone">
                                            <div class="col-4">
                                                <input type="tel" id="phone" name="phone" placeholder="Enter your number here" pattern="[+63]" required>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>    
            </div>
    
        </div>
    </body>
    
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    
    <script>
        const input = document.querySelector("#phone");
        window.intlTelInput(input, {
            initialCountry: "auto",
            geoIpLookup: function(callback) {
                fetch("https://ipinfo.io?token=YOUR_TOKEN")
                    .then(response => response.json())
                    .then(data => callback(data.country))
                    .catch(() => callback("PH"));
            },
            preferredCountries: ["us", "gb", "ph"],
            separateDialCode: true,
        });

        async function fetchData(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const password1 = document.getElementById('password1').value;
            const password2 = document.getElementById('password2').value;

            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, firstName, lastName, email, password1, password2 })
                });

                const data = await response.json();  // Await the JSON parsing

                const messageElement = document.getElementById('message');

                if (response.ok) {
                    console.log(data.message);
                    messageElement.innerText = data.message || "User registered successfully";
                    messageElement.className = "alert alert-success";
                    messageElement.style.display = "block";
                    window.location.href = '/';
                } else {
                    messageElement.innerText = data.error || "Failed to register user";
                    messageElement.className = "alert alert-danger";
                    messageElement.style.display = "block";
                    console.log(`Error in register function: ${data.error}`);
                }
            } catch (error) {
                console.error(`Error: ${error}`);
            }
        }

    </script>
    
</html>